(()=>{"use strict";const e=window.wp.element,t=window.ReactJSXRuntime,r=({filter:e,onFilterChange:r,onExport:a})=>(0,t.jsxs)("div",{className:"filter-bar",children:[(0,t.jsx)("label",{children:"Context:"}),(0,t.jsxs)("select",{value:e,onChange:e=>r(e.target.value),children:[(0,t.jsx)("option",{value:"all",children:"All"}),(0,t.jsx)("option",{value:"post",children:"Posts/Pages"}),(0,t.jsx)("option",{value:"meta",children:"Meta"}),(0,t.jsx)("option",{value:"option",children:"Options"})]}),(0,t.jsx)("button",{onClick:a,children:"Export CSV"})]}),a=({items:e,onReplace:r})=>(0,t.jsxs)("table",{className:"table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Context"}),(0,t.jsx)("th",{children:"ID"}),(0,t.jsx)("th",{children:"Label"}),(0,t.jsx)("th",{children:"Term"}),(0,t.jsx)("th",{children:"View"}),(0,t.jsx)("th",{children:"Replace"})]})}),(0,t.jsx)("tbody",{children:e.map((e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.context}),(0,t.jsx)("td",{children:e.ID}),(0,t.jsx)("td",{children:e.label}),(0,t.jsx)("td",{children:e.term}),(0,t.jsx)("td",{children:(0,t.jsx)("a",{href:`${e.view_url}${e.view_url.includes("?")?"&":"?"}rebrand_term=${encodeURIComponent(e.term)}`,target:"_blank",rel:"noopener noreferrer",children:"View"})}),(0,t.jsx)("td",{children:(0,t.jsx)("button",{type:"button",onClick:()=>r(e),children:"Replace"})})]},`${e.context}-${e.ID}-${e.term}`)))})]}),n=({page:e,pages:r,onPageChange:a})=>(0,t.jsx)("div",{className:"pagination",children:Array.from({length:r},((r,n)=>(0,t.jsx)("button",{disabled:n+1===e,onClick:()=>a(n+1),children:n+1},n)))}),c=()=>{const[c,l]=(0,e.useState)({terms:[],matches:[]}),[s,o]=(0,e.useState)("all"),[i,d]=(0,e.useState)(1),[h,x]=(0,e.useState)(""),[m,j]=(0,e.useState)(""),p=()=>fetch(`${RebrandTrackerData.ajax_url}?action=rebrand_tracker_get_data&nonce=${RebrandTrackerData.nonce}`).then((e=>e.json())).then((e=>{e.success&&(l(e.data),e.data.terms&&e.data.terms.length>0&&x(e.data.terms[0]))}));(0,e.useEffect)(p,[]),(0,e.useEffect)((()=>{const e=localStorage.getItem("rebrand_replaceTerm");e&&j(e)}),[]),(0,e.useEffect)((()=>{localStorage.setItem("rebrand_replaceTerm",m)}),[m]);const u=c.matches.filter((e=>"all"===s||e.context===s)),b=Math.ceil(u.length/20),g=u.slice(20*(i-1),20*i);return(0,t.jsxs)(e.Fragment,{children:[(0,t.jsxs)("div",{className:"search-replace",children:[(0,t.jsx)("input",{type:"text",placeholder:"Search term",value:h,onChange:e=>x(e.target.value)}),(0,t.jsx)("input",{type:"text",placeholder:"Replace term",value:m,onChange:e=>j(e.target.value)}),(0,t.jsx)("button",{onClick:()=>{if(!h.trim())return;const e=[h.trim()];fetch(RebrandTrackerData.ajax_url,{method:"POST",body:new URLSearchParams({action:"rebrand_tracker_set_terms",nonce:RebrandTrackerData.nonce,terms:JSON.stringify(e)})}).then((e=>e.json())).then((e=>{e.success&&(d(1),p())}))},children:"Search"})]}),(0,t.jsx)("h1",{children:"Content Rebrand Tracker"}),(0,t.jsx)(r,{filter:s,onFilterChange:e=>{o(e),d(1)},onExport:()=>{const e=`${RebrandTrackerData.ajax_url}?action=rebrand_tracker_export_csv&nonce=${RebrandTrackerData.nonce}&filter_term=${"all"===s?"":s}&context=${s}`;window.location=e}}),(0,t.jsx)(a,{items:g,onReplace:e=>{m.trim()?fetch(RebrandTrackerData.ajax_url,{method:"POST",body:new URLSearchParams({action:"rebrand_tracker_replace_item",nonce:RebrandTrackerData.nonce,context:e.context,id:e.ID,term:e.term,replace:m.trim()})}).then((e=>e.json())).then((e=>{e.success?(j(""),d(1),p()):alert(e.data)})):alert("Please enter a Replace term.")}}),(0,t.jsx)(n,{page:i,pages:b,onPageChange:d})]})};(0,e.render)((0,t.jsx)(c,{}),document.getElementById("rebrand-tracker-app"))})();